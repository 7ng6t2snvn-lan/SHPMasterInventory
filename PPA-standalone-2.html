<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPA - Peptide & Performance Analytics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27;
            min-height: 100vh;
            color: #e2e8f0;
        }

        /* PIN Screen */
        #pinScreen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: #0a0e27;
        }

        .pin-container {
            background: #1a1f3a;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 400px;
            width: 100%;
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        .pin-container h1 {
            color: #06b6d4;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .pin-container p {
            color: #94a3b8;
            margin-bottom: 30px;
        }

        #pinInput {
            width: 100%;
            padding: 15px;
            font-size: 32px;
            text-align: center;
            border: 2px solid #2d3548;
            border-radius: 10px;
            margin-bottom: 20px;
            letter-spacing: 20px;
            font-weight: bold;
            background: #0f1629;
            color: #06b6d4;
            caret-color: transparent;
        }

        #pinInput:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }
        
        /* Digital Keypad */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .key-btn {
            padding: 20px;
            font-size: 24px;
            font-weight: 600;
            background: #0f1629;
            border: 2px solid #2d3548;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #e2e8f0;
        }
        
        .key-btn:active {
            transform: scale(0.95);
            background: #1a1f3a;
            border-color: #06b6d4;
        }
        
        .key-btn.delete {
            background: #1e1b2e;
            color: #ef4444;
            border-color: #3d2a2a;
        }
        
        .enter-btn {
            grid-column: span 3;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }
        
        .enter-btn:active {
            transform: scale(0.98);
        }
        
        .enter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pin-error {
            color: #ef4444;
            margin-top: 10px;
            display: none;
        }

        /* Main App */
        #mainApp {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            background: #1a1f3a;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid rgba(6, 182, 212, 0.1);
        }

        .app-header h1 {
            color: #06b6d4;
            font-size: 1.8em;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .lock-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .lock-btn:hover {
            background: #dc2626;
        }

        /* Navigation */
        .nav-tabs {
            background: #1a1f3a;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: flex;
            gap: 10px;
            overflow-x: auto;
            flex-wrap: wrap;
            border: 1px solid rgba(6, 182, 212, 0.1);
        }

        .nav-tab {
            padding: 12px 24px;
            border: none;
            background: #0f1629;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #94a3b8;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #1a1f3a;
            color: #e2e8f0;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        /* Content Area */
        .content-area {
            background: #1a1f3a;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            min-height: 500px;
            border: 1px solid rgba(6, 182, 212, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            font-size: 13px;
            opacity: 0.8;
        }

        /* Database */
        .search-container {
            margin-bottom: 25px;
        }

        .search-box {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #2d3548;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: #0f1629;
            color: #e2e8f0;
        }

        .search-box:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #06b6d4;
            background: white;
            color: #06b6d4;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: #f0f0f0;
        }

        .filter-btn.active {
            background: #06b6d4;
            color: white;
        }

        .substance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .substance-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .substance-card:hover {
            background: #fff;
            border-color: #06b6d4;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .substance-card h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .substance-card .category {
            display: inline-block;
            padding: 4px 12px;
            background: #06b6d4;
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .substance-card .info {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e8e8e8;
        }

        .add-new-btn {
            margin-bottom: 20px;
        }
        
        .btn-small {
            padding: 6px 14px;
            font-size: 13px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            position: relative;
        }

        .modal-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            color: #333;
            font-size: 24px;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: #f0f0f0;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .form-actions button {
            flex: 1;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                text-align: center;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
                text-align: center;
            }

            .substance-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- PIN Screen -->
    <div id="pinScreen">
        <div class="pin-container">
            <h1>PPA</h1>
            <p>Peptide & Performance Analytics</p>
            <input type="text" id="pinInput" readonly placeholder="â€¢â€¢â€¢â€¢" maxlength="4">
            <div class="keypad">
                <button class="key-btn" onclick="addDigit('1')">1</button>
                <button class="key-btn" onclick="addDigit('2')">2</button>
                <button class="key-btn" onclick="addDigit('3')">3</button>
                <button class="key-btn" onclick="addDigit('4')">4</button>
                <button class="key-btn" onclick="addDigit('5')">5</button>
                <button class="key-btn" onclick="addDigit('6')">6</button>
                <button class="key-btn" onclick="addDigit('7')">7</button>
                <button class="key-btn" onclick="addDigit('8')">8</button>
                <button class="key-btn" onclick="addDigit('9')">9</button>
                <button class="key-btn delete" onclick="deleteDigit()">âŒ«</button>
                <button class="key-btn" onclick="addDigit('0')">0</button>
                <button class="key-btn delete" onclick="clearPin()">C</button>
            </div>
            <button class="enter-btn" id="enterBtn" onclick="checkPin()" disabled>Enter</button>
            <div class="pin-error" id="pinError">Incorrect PIN</div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp">
        <div class="app-header">
            <h1>PPA</h1>
            <div class="header-actions">
                <button class="lock-btn" onclick="lockApp()">ðŸ”’ Lock</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="switchTab('database')">Database</button>
            <button class="nav-tab" onclick="switchTab('inventory')">Inventory</button>
            <button class="nav-tab" onclick="switchTab('transactions')">Transactions</button>
            <button class="nav-tab" onclick="switchTab('groupbuys')">Group Buys</button>
            <button class="nav-tab" onclick="switchTab('reports')">Reports</button>
        </div>

        <div class="content-area">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2 style="margin-bottom: 25px;">Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Items</h3>
                        <div class="stat-value" id="totalItems">0</div>
                        <div class="stat-label">In Database</div>
                    </div>
                    <div class="stat-card">
                        <h3>Inventory Value</h3>
                        <div class="stat-value" id="inventoryValue">$0</div>
                        <div class="stat-label">Current Stock</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Items</h3>
                        <div class="stat-value" id="activeItems">0</div>
                        <div class="stat-label">In Stock</div>
                    </div>
                    <div class="stat-card">
                        <h3>Transactions</h3>
                        <div class="stat-value" id="totalTransactions">0</div>
                        <div class="stat-label">This Month</div>
                    </div>
                </div>
                <h3 style="margin: 30px 0 15px 0;">Recent Activity</h3>
                <div id="recentActivity"></div>
            </div>

            <!-- Database Tab -->
            <div id="database" class="tab-content">
                <h2 style="margin-bottom: 25px;">Substance Database</h2>
                <button class="btn btn-primary add-new-btn" onclick="openAddSubstanceModal()">+ Add New Substance</button>
                
                <div class="search-container">
                    <input type="text" class="search-box" id="searchBox" placeholder="Search substances..." onkeyup="filterSubstances()">
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterByCategory('all')">All</button>
                        <button class="filter-btn" onclick="filterByCategory('peptide')">Peptides</button>
                        <button class="filter-btn" onclick="filterByCategory('bioregulator')">Bioregulators</button>
                        <button class="filter-btn" onclick="filterByCategory('aas')">Anabolic Steroids</button>
                        <button class="filter-btn" onclick="filterByCategory('custom')">Custom</button>
                    </div>
                </div>

                <div class="substance-grid" id="substanceGrid"></div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-content">
                <h2 style="margin-bottom: 25px;">Current Inventory</h2>
                <div id="inventoryContent"></div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content">
                <h2 style="margin-bottom: 25px;">Transaction History</h2>
                <div id="transactionsContent"></div>
            </div>

            <!-- Group Buys Tab -->
            <div id="groupbuys" class="tab-content">
                <h2 style="margin-bottom: 25px;">Group Buys</h2>
                <button class="btn btn-primary add-new-btn" onclick="openAddGroupBuyModal()">+ New Group Buy</button>
                <div id="groupbuysContent"></div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2 style="margin-bottom: 25px;">Reports & Export</h2>
                <div style="display: grid; gap: 15px; max-width: 600px;">
                    <button class="btn btn-primary" onclick="exportToCSV()">ðŸ“Š Export to CSV</button>
                    <button class="btn btn-primary" onclick="exportToGoogleSheets()">ðŸ“— Export to Google Sheets</button>
                    <button class="btn btn-primary" onclick="importFromGoogleSheets()">ðŸ“¥ Import from Google Sheets</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Substance Modal -->
    <div id="addSubstanceModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('addSubstanceModal')">&times;</span>
            <div class="modal-header">
                <h2>Add New Substance</h2>
            </div>
            <form id="addSubstanceForm">
                <div class="form-group">
                    <label>Substance Name *</label>
                    <input type="text" id="substanceName" required>
                </div>
                <div class="form-group">
                    <label>Category *</label>
                    <select id="substanceCategory" required>
                        <option value="peptide">Peptide</option>
                        <option value="bioregulator">Bioregulator</option>
                        <option value="aas">Anabolic Steroid</option>
                        <option value="custom">Custom/Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Common Dosages</label>
                    <input type="text" id="substanceDosage" placeholder="e.g., 250-500 mcg/day">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="substanceNotes"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addSubstanceModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Substance</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add to Inventory Modal -->
    <div id="addInventoryModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('addInventoryModal')">&times;</span>
            <div class="modal-header">
                <h2>Add to Inventory</h2>
                <p id="selectedSubstanceName" style="color: #06b6d4; font-weight: 600; margin-top: 5px;"></p>
            </div>
            <form id="addInventoryForm">
                <input type="hidden" id="invSubstanceId">
                <div class="form-group">
                    <label>Transaction Type *</label>
                    <select id="transactionType" required onchange="toggleGroupBuyFields()">
                        <option value="purchase">Purchase</option>
                        <option value="groupbuy">Group Buy</option>
                        <option value="gift">Gift/Sample</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date Received *</label>
                    <input type="date" id="dateReceived" required>
                </div>
                <div class="form-group">
                    <label>Quantity (Number of Vials) *</label>
                    <input type="number" id="quantity" step="1" min="0" required>
                </div>
                <div class="form-group">
                    <label>Vial Size (mg per vial) *</label>
                    <input type="number" id="vialSize" step="0.1" min="0" required>
                </div>
                <div class="form-group">
                    <label>Total mg (auto-calculated)</label>
                    <input type="text" id="totalMg" readonly style="background: #f5f5f5;">
                </div>
                <div class="form-group">
                    <label>Price Paid *</label>
                    <input type="number" id="pricePaid" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Vendor/Source *</label>
                    <input type="text" id="vendor" required>
                </div>
                <div class="form-group">
                    <label>Lot/Batch Number</label>
                    <input type="text" id="lotNumber">
                </div>
                
                <div id="groupBuyFields" style="display: none; border-top: 2px solid #f0f0f0; padding-top: 20px; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: #06b6d4;">Group Buy Details</h4>
                    <div class="form-group">
                        <label>Group Buy Organizer</label>
                        <input type="text" id="gbOrganizer">
                    </div>
                    <div class="form-group">
                        <label>Amount Paid to Organizer</label>
                        <input type="number" id="gbAmount" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>Payment Date</label>
                        <input type="date" id="gbPaymentDate">
                    </div>
                    <div class="form-group">
                        <label>Payment Method</label>
                        <select id="gbPaymentMethod">
                            <option value="">Select...</option>
                            <option value="venmo">Venmo</option>
                            <option value="paypal">PayPal</option>
                            <option value="zelle">Zelle</option>
                            <option value="cash">Cash</option>
                            <option value="crypto">Cryptocurrency</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="invNotes"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addInventoryModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add to Inventory</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Group Buy Modal -->
    <div id="addGroupBuyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('addGroupBuyModal')">&times;</span>
            <div class="modal-header">
                <h2>New Group Buy</h2>
            </div>
            <form id="addGroupBuyForm">
                <div class="form-group">
                    <label>Group Buy Name *</label>
                    <input type="text" id="gbName" required>
                </div>
                <div class="form-group">
                    <label>Organizer *</label>
                    <input type="text" id="gbOrganizerStandalone" required>
                </div>
                <div class="form-group">
                    <label>Total Amount *</label>
                    <input type="number" id="gbTotalAmount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Payment Date</label>
                    <input type="date" id="gbDate">
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select id="gbMethod">
                        <option value="">Select...</option>
                        <option value="venmo">Venmo</option>
                        <option value="paypal">PayPal</option>
                        <option value="zelle">Zelle</option>
                        <option value="cash">Cash</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status *</label>
                    <select id="gbStatus" required>
                        <option value="pending">Pending</option>
                        <option value="paid">Paid</option>
                        <option value="received">Received</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="gbNotes"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addGroupBuyModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Group Buy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Use/Sell Inventory Modal -->
    <div id="useSellModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('useSellModal')">&times;</span>
            <div class="modal-header">
                <h2>Use/Sell Inventory</h2>
                <p id="useSellSubstanceName"></p>
            </div>
            <form id="useSellForm">
                <input type="hidden" id="useSellSubstanceId">
                <div class="form-group">
                    <label>Transaction Type *</label>
                    <select id="useSellType" required>
                        <option value="use">Personal Use</option>
                        <option value="sell">Sold</option>
                        <option value="dispose">Disposed/Expired</option>
                        <option value="gift">Gifted</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" id="useSellDate" required>
                </div>
                <div class="form-group">
                    <label>Quantity (Number of Vials) *</label>
                    <input type="number" id="useSellQuantity" step="1" min="0.1" required>
                </div>
                <div class="form-group" id="sellPriceGroup" style="display: none;">
                    <label>Sale Price</label>
                    <input type="number" id="sellPrice" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="useSellNotes"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('useSellModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Record Transaction</button>
                </div>
            </form>
        </div>
    </div>

    <script>
// DATABASE - Embedded
const DATABASE = {
    peptides: [
        {id: 'pep001', name: 'BPC-157', category: 'peptide', commonDosage: '200-500 mcg/day', notes: 'Healing peptide, gastric protective'},
        {id: 'pep002', name: 'TB-500 (Thymosin Beta-4)', category: 'peptide', commonDosage: '2-5 mg/week', notes: 'Tissue repair and regeneration'},
        {id: 'pep003', name: 'Tesamorelin', category: 'peptide', commonDosage: '1-2 mg/day', notes: 'GHRH analog, reduces visceral fat'},
        {id: 'pep004', name: 'Ipamorelin', category: 'peptide', commonDosage: '200-300 mcg 2-3x/day', notes: 'GH secretagogue, GHRP'},
        {id: 'pep005', name: 'CJC-1295 (without DAC)', category: 'peptide', commonDosage: '100 mcg 2-3x/day', notes: 'GHRH analog'},
        {id: 'pep006', name: 'CJC-1295 (with DAC)', category: 'peptide', commonDosage: '2 mg/week', notes: 'Long-acting GHRH analog'},
        {id: 'pep007', name: 'Sermorelin', category: 'peptide', commonDosage: '200-500 mcg/day', notes: 'GHRH 1-29, GH secretagogue'},
        {id: 'pep008', name: 'GHRP-2', category: 'peptide', commonDosage: '100-300 mcg 2-3x/day', notes: 'Growth hormone releasing peptide'},
        {id: 'pep009', name: 'GHRP-6', category: 'peptide', commonDosage: '100-200 mcg 2-3x/day', notes: 'GH secretagogue, increases appetite'},
        {id: 'pep010', name: 'Hexarelin', category: 'peptide', commonDosage: '100 mcg 2-3x/day', notes: 'Potent GH secretagogue'},
        {id: 'pep011', name: 'IGF-1 LR3', category: 'peptide', commonDosage: '20-100 mcg/day', notes: 'Long-acting insulin-like growth factor'},
        {id: 'pep012', name: 'IGF-1 DES', category: 'peptide', commonDosage: '50-150 mcg/day', notes: 'Short-acting, localized IGF-1'},
        {id: 'pep013', name: 'HGH (Somatropin)', category: 'peptide', commonDosage: '2-4 IU/day', notes: 'Recombinant human growth hormone'},
        {id: 'pep014', name: 'Melanotan II', category: 'peptide', commonDosage: '0.5-1 mg 2-3x/week', notes: 'Tanning peptide, melanocortin receptor agonist'},
        {id: 'pep015', name: 'PT-141 (Bremelanotide)', category: 'peptide', commonDosage: '1-2 mg as needed', notes: 'Sexual dysfunction treatment'},
        {id: 'pep016', name: 'Selank', category: 'peptide', commonDosage: '250-500 mcg 2x/day', notes: 'Anxiolytic, nootropic peptide'},
        {id: 'pep017', name: 'Semax', category: 'peptide', commonDosage: '200-400 mcg 2x/day', notes: 'Cognitive enhancement, neuroprotective'},
        {id: 'pep018', name: 'Epithalon (Epitalon)', category: 'peptide', commonDosage: '5-10 mg/cycle', notes: 'Telomerase activator, anti-aging'},
        {id: 'pep019', name: 'Thymalin', category: 'peptide', commonDosage: '10 mg/day for 10 days', notes: 'Thymus extract, immune modulation'},
        {id: 'pep020', name: 'Thymulin', category: 'peptide', commonDosage: '1-2 mg/week', notes: 'Immune system support'},
        {id: 'pep021', name: 'GHK-Cu', category: 'peptide', commonDosage: '1-2 mg 2-3x/week', notes: 'Copper peptide, wound healing, anti-aging'},
        {id: 'pep022', name: 'Cerebrolysin', category: 'peptide', commonDosage: '5-10 ml/day', notes: 'Neurotrophic peptide complex'},
        {id: 'pep023', name: 'P21', category: 'peptide', commonDosage: '1-3 mg/week', notes: 'Cognitive enhancement, neurogenesis'},
        {id: 'pep024', name: 'Dihexa', category: 'peptide', commonDosage: '1-5 mg/day', notes: 'Cognitive enhancement, synapse formation'},
        {id: 'pep025', name: 'NA-Selank', category: 'peptide', commonDosage: '500-1000 mcg 2x/day', notes: 'N-acetyl Selank, enhanced stability'},
        {id: 'pep026', name: 'NA-Semax', category: 'peptide', commonDosage: '400-800 mcg 2x/day', notes: 'N-acetyl Semax, enhanced stability'},
        {id: 'pep027', name: 'Semax Amidate', category: 'peptide', commonDosage: '300-600 mcg 2x/day', notes: 'Longer-acting Semax variant'},
        {id: 'pep028', name: 'AOD-9604', category: 'peptide', commonDosage: '300 mcg/day', notes: 'Fat loss peptide, HGH fragment'},
        {id: 'pep029', name: 'HGH Fragment 176-191', category: 'peptide', commonDosage: '250-500 mcg 2x/day', notes: 'Fat loss, no effect on blood sugar'},
        {id: 'pep030', name: 'MOTS-c', category: 'peptide', commonDosage: '5-10 mg 2-3x/week', notes: 'Mitochondrial peptide, metabolic regulation'},
        {id: 'pep031', name: 'Humanin', category: 'peptide', commonDosage: '2-4 mg 3x/week', notes: 'Mitochondrial peptide, neuroprotective'},
        {id: 'pep032', name: 'SS-31 (Elamipretide)', category: 'peptide', commonDosage: '5-40 mg/day', notes: 'Mitochondrial health, cardioprotective'},
        {id: 'pep033', name: 'Kisspeptin-10', category: 'peptide', commonDosage: '1-10 mcg/kg', notes: 'Reproductive hormone regulation'},
        {id: 'pep034', name: 'Gonadorelin', category: 'peptide', commonDosage: '100 mcg 2-3x/week', notes: 'GnRH, LH/FSH secretion'},
        {id: 'pep035', name: 'Triptorelin', category: 'peptide', commonDosage: '100 mcg/week', notes: 'GnRH agonist, hormone regulation'},
        {id: 'pep036', name: 'HCG (Human Chorionic Gonadotropin)', category: 'peptide', commonDosage: '250-500 IU 2-3x/week', notes: 'LH analog, testicular function'},
        {id: 'pep037', name: 'HMG (Human Menopausal Gonadotropin)', category: 'peptide', commonDosage: '75-150 IU 2-3x/week', notes: 'FSH/LH activity, fertility'},
        {id: 'pep038', name: 'Follistatin 344', category: 'peptide', commonDosage: '100 mcg/day', notes: 'Myostatin inhibitor, muscle growth'},
        {id: 'pep039', name: 'ACE-031', category: 'peptide', commonDosage: '1-3 mg/week', notes: 'Myostatin inhibitor'},
        {id: 'pep040', name: 'YK-11', category: 'peptide', commonDosage: '5-10 mg/day', notes: 'Myostatin inhibitor, SARM-like'},
        {id: 'pep041', name: 'Adipotide', category: 'peptide', commonDosage: '1 mg/day', notes: 'Targeted fat loss peptide'},
        {id: 'pep042', name: '5-Amino-1MQ', category: 'peptide', commonDosage: '50 mg/day', notes: 'NNMT inhibitor, fat loss'},
        {id: 'pep043', name: 'Tesofensine', category: 'peptide', commonDosage: '0.25-0.5 mg/day', notes: 'Weight loss, appetite suppression'},
        {id: 'pep044', name: 'Semaglutide', category: 'peptide', commonDosage: '0.25-2.4 mg/week', notes: 'GLP-1 agonist, weight loss'},
        {id: 'pep045', name: 'Tirzepatide', category: 'peptide', commonDosage: '2.5-15 mg/week', notes: 'GLP-1/GIP agonist, weight loss'},
        {id: 'pep046', name: 'Liraglutide', category: 'peptide', commonDosage: '0.6-3 mg/day', notes: 'GLP-1 agonist, diabetes/weight loss'},
        {id: 'pep047', name: 'Dulaglutide', category: 'peptide', commonDosage: '0.75-1.5 mg/week', notes: 'GLP-1 agonist'},
        {id: 'pep048', name: 'Retatrutide', category: 'peptide', commonDosage: '4-12 mg/week', notes: 'Triple agonist, weight loss'},
        {id: 'pep049', name: 'CagriSema', category: 'peptide', commonDosage: 'Variable', notes: 'Combination peptide'},
        {id: 'pep050', name: 'Oxytocin', category: 'peptide', commonDosage: '10-40 IU/day', notes: 'Social bonding, anxiolytic'},
        {id: 'pep051', name: 'Vasopressin', category: 'peptide', commonDosage: '5-20 IU as needed', notes: 'Antidiuretic hormone'},
        {id: 'pep052', name: 'Desmopressin', category: 'peptide', commonDosage: '0.1-0.4 mg/day', notes: 'Synthetic vasopressin analog'},
        {id: 'pep053', name: 'Thymosin Alpha-1', category: 'peptide', commonDosage: '1.6 mg 2x/week', notes: 'Immune system enhancement'},
        {id: 'pep054', name: 'LL-37', category: 'peptide', commonDosage: '5 mg 2x/week', notes: 'Antimicrobial peptide, immune support'},
        {id: 'pep055', name: 'KPV', category: 'peptide', commonDosage: '500-1000 mcg/day', notes: 'Anti-inflammatory peptide'},
        {id: 'pep056', name: 'GHK', category: 'peptide', commonDosage: '1-2 mg 3x/week', notes: 'Tissue repair, anti-inflammatory'},
        {id: 'pep057', name: 'Copper Peptide GHK-Cu', category: 'peptide', commonDosage: '1-3 mg 3x/week', notes: 'Skin health, wound healing'},
        {id: 'pep058', name: 'Matrixyl (Palmitoyl Pentapeptide)', category: 'peptide', commonDosage: 'Topical', notes: 'Collagen production, anti-aging'},
        {id: 'pep059', name: 'Argireline', category: 'peptide', commonDosage: 'Topical', notes: 'Anti-wrinkle, muscle relaxant'},
        {id: 'pep060', name: 'Snap-8', category: 'peptide', commonDosage: 'Topical', notes: 'Anti-wrinkle peptide'},
        {id: 'pep061', name: 'Melanotan I', category: 'peptide', commonDosage: '0.5-1 mg 2x/week', notes: 'Tanning peptide, safer than MT2'},
        {id: 'pep062', name: 'DSIP (Delta Sleep-Inducing Peptide)', category: 'peptide', commonDosage: '100-300 mcg before bed', notes: 'Sleep quality, stress reduction'},
        {id: 'pep063', name: 'Pinealon', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Brain/nervous system support'},
        {id: 'pep064', name: 'Cortagen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Brain and immune system'},
        {id: 'pep065', name: 'Vilon', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Immune and digestive system'},
        {id: 'pep066', name: 'Thyreogen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Thyroid support'},
        {id: 'pep067', name: 'Vezugen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Vascular system support'},
        {id: 'pep068', name: 'Bronchogen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Respiratory system support'},
        {id: 'pep069', name: 'Cardiogen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Cardiovascular support'},
        {id: 'pep070', name: 'Hepatogen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Liver support'},
        {id: 'pep071', name: 'Pielotax', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Kidney support'},
        {id: 'pep072', name: 'Prostatilen', category: 'bioregulator', commonDosage: '10 mg/day for 10 days', notes: 'Prostate health'},
        {id: 'pep073', name: 'Ovagen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Digestive system support'},
        {id: 'pep074', name: 'Endoluten', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Pineal gland, circadian rhythm'},
        {id: 'pep075', name: 'Crystagen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Immune system support'},
        {id: 'pep076', name: 'Gotratix', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Muscle tissue support'},
        {id: 'pep077', name: 'Sigumir', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Cartilage and joint support'},
        {id: 'pep078', name: 'Vladonix', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Thymus and immune system'},
        {id: 'pep079', name: 'Chonluten', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Bronchial and lung support'},
        {id: 'pep080', name: 'Ventfort', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Vascular system peptide'},
        {id: 'pep081', name: 'Stamakort', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Gastric mucosa support'},
        {id: 'pep082', name: 'Cerluten', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Brain and nervous system'},
        {id: 'pep083', name: 'Honluten', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Respiratory system'},
        {id: 'pep084', name: 'Libidon', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Prostate and urinary health'},
        {id: 'pep085', name: 'Testagen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Testicular function'},
        {id: 'pep086', name: 'Zhenoluten', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Ovarian function support'},
        {id: 'pep087', name: 'Svetinorm', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Liver bioregulator'},
        {id: 'pep088', name: 'Cerebramin', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Brain tissue extract'},
        {id: 'pep089', name: 'Glandokort', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Adrenal gland support'},
        {id: 'pep090', name: 'Pankragen', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Pancreas support'},
        {id: 'pep091', name: 'Chelohart', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Heart muscle support'},
        {id: 'pep092', name: 'Suprefort', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Pancreatic islet cells'},
        {id: 'pep093', name: 'Taxorest', category: 'bioregulator', commonDosage: '20 mg/day for 10 days', notes: 'Respiratory tract support'},
        {id: 'pep094', name: 'PNC-27', category: 'peptide', commonDosage: 'Variable', notes: 'Cancer research peptide'},
        {id: 'pep095', name: 'FOXO4-DRI', category: 'peptide', commonDosage: 'Variable', notes: 'Senolytic peptide'},
        {id: 'pep096', name: 'Pentosan Polysulfate', category: 'peptide', commonDosage: '100 mg 2x/week', notes: 'Joint and cartilage repair'},
        {id: 'pep097', name: 'Actovegin', category: 'peptide', commonDosage: 'Variable', notes: 'Blood derivative, metabolism'},
        {id: 'pep098', name: 'FGL (Fluoroglycofen)', category: 'peptide', commonDosage: '1 mg/day', notes: 'Cognitive enhancement'},
        {id: 'pep099', name: 'Noopept', category: 'peptide', commonDosage: '10-30 mg/day', notes: 'Nootropic peptide'},
        {id: 'pep100', name: 'N-Acetyl Semax Amidate', category: 'peptide', commonDosage: '300-600 mcg 2x/day', notes: 'Enhanced cognitive peptide'},
        {id: 'pep101', name: 'Epitalon Amidate', category: 'peptide', commonDosage: '5-10 mg/cycle', notes: 'Longer-acting epithalon'},
        {id: 'pep102', name: 'Mifepristone RU-486', category: 'peptide', commonDosage: 'Medical supervision', notes: 'Cortisol antagonist'},
        {id: 'pep103', name: 'Oxiracetam', category: 'peptide', commonDosage: '800-2400 mg/day', notes: 'Racetam nootropic'},
        {id: 'pep104', name: 'Aniracetam', category: 'peptide', commonDosage: '750-1500 mg/day', notes: 'Anxiolytic nootropic'},
        {id: 'pep105', name: 'Phenylpiracetam', category: 'peptide', commonDosage: '100-200 mg/day', notes: 'Stimulating nootropic'},
        {id: 'pep106', name: 'Coluracetam', category: 'peptide', commonDosage: '20-80 mg/day', notes: 'Memory enhancement'},
        {id: 'pep107', name: 'Sunifiram', category: 'peptide', commonDosage: '5-10 mg/day', notes: 'Potent nootropic'},
        {id: 'pep108', name: 'NSI-189', category: 'peptide', commonDosage: '40 mg/day', notes: 'Neurogenesis, depression'},
        {id: 'pep109', name: 'Compound 7P', category: 'peptide', commonDosage: '1-3 mg/day', notes: 'Cognitive enhancement'},
        {id: 'pep110', name: 'J147', category: 'peptide', commonDosage: 'Variable', notes: 'Neuroprotective compound'},
        {id: 'pep111', name: 'CMS-121', category: 'peptide', commonDosage: 'Variable', notes: 'Alzheimer\'s research'},
        {id: 'pep112', name: 'Alcar (Acetyl-L-Carnitine)', category: 'peptide', commonDosage: '500-2000 mg/day', notes: 'Energy, cognitive support'},
        {id: 'pep113', name: 'NAC (N-Acetyl Cysteine)', category: 'peptide', commonDosage: '600-1800 mg/day', notes: 'Antioxidant, glutathione precursor'},
        {id: 'pep114', name: 'Glutathione', category: 'peptide', commonDosage: '200-500 mg/day', notes: 'Master antioxidant'},
        {id: 'pep115', name: 'NAD+ (Injectable)', category: 'peptide', commonDosage: '100-500 mg/session', notes: 'Cellular energy, longevity'},
        {id: 'pep116', name: 'NMN (Injectable)', category: 'peptide', commonDosage: '50-250 mg 3x/week', notes: 'NAD+ precursor'},
        {id: 'pep117', name: 'Alpha-Lipoic Acid (Injectable)', category: 'peptide', commonDosage: '300-600 mg/week', notes: 'Antioxidant, neuroprotective'},
        {id: 'pep118', name: 'MIC (Methionine Inositol Choline)', category: 'peptide', commonDosage: '1 ml 1-3x/week', notes: 'Lipotropic fat loss injection'},
        {id: 'pep119', name: 'L-Carnitine (Injectable)', category: 'peptide', commonDosage: '500-1000 mg 2-3x/week', notes: 'Fat metabolism, energy'},
        {id: 'pep120', name: 'B-Complex (Injectable)', category: 'peptide', commonDosage: '1-2 ml/week', notes: 'Energy, metabolism'},
        {id: 'pep121', name: 'Vitamin D3 (Injectable)', category: 'peptide', commonDosage: '50,000 IU monthly', notes: 'Vitamin D supplementation'}
    ],
    
    steroids: [
        {id: 'aas001', name: 'Testosterone Cypionate', category: 'aas', commonDosage: '100-500 mg/week', notes: 'Long-acting testosterone ester'},
        {id: 'aas002', name: 'Testosterone Enanthate', category: 'aas', commonDosage: '100-500 mg/week', notes: 'Long-acting testosterone ester'},
        {id: 'aas003', name: 'Testosterone Propionate', category: 'aas', commonDosage: '50-150 mg EOD', notes: 'Short-acting testosterone ester'},
        {id: 'aas004', name: 'Testosterone Phenylpropionate', category: 'aas', commonDosage: '100-300 mg/week', notes: 'Medium-acting testosterone ester'},
        {id: 'aas005', name: 'Testosterone Isocaproate', category: 'aas', commonDosage: '100-300 mg/week', notes: 'Medium-acting testosterone ester'},
        {id: 'aas006', name: 'Testosterone Decanoate', category: 'aas', commonDosage: '200-400 mg/2 weeks', notes: 'Very long-acting testosterone ester'},
        {id: 'aas007', name: 'Testosterone Undecanoate', category: 'aas', commonDosage: '750-1000 mg/10-14 weeks', notes: 'Ultra long-acting testosterone ester'},
        {id: 'aas008', name: 'Sustanon 250', category: 'aas', commonDosage: '250-750 mg/week', notes: 'Testosterone blend (4 esters)'},
        {id: 'aas009', name: 'Omnadren', category: 'aas', commonDosage: '250-750 mg/week', notes: 'Testosterone blend (4 esters)'},
        {id: 'aas010', name: 'Testosterone Suspension', category: 'aas', commonDosage: '50-100 mg/day', notes: 'No ester, water-based'},
        {id: 'aas011', name: 'TNE (Test No Ester)', category: 'aas', commonDosage: '50-100 mg pre-workout', notes: 'Pre-workout testosterone base'},
        {id: 'aas012', name: 'Nandrolone Decanoate (Deca)', category: 'aas', commonDosage: '200-600 mg/week', notes: 'Long-acting 19-nor, joint support'},
        {id: 'aas013', name: 'Nandrolone Phenylpropionate (NPP)', category: 'aas', commonDosage: '100-200 mg EOD', notes: 'Short-acting 19-nor'},
        {id: 'aas014', name: 'Trenbolone Acetate', category: 'aas', commonDosage: '50-100 mg EOD', notes: 'Short-acting, potent 19-nor'},
        {id: 'aas015', name: 'Trenbolone Enanthate', category: 'aas', commonDosage: '200-600 mg/week', notes: 'Long-acting trenbolone'},
        {id: 'aas016', name: 'Trenbolone Hexahydrobenzylcarbonate', category: 'aas', commonDosage: '150-300 mg/week', notes: 'Parabolan, long-acting tren'},
        {id: 'aas017', name: 'Boldenone Undecylenate (Equipoise)', category: 'aas', commonDosage: '300-600 mg/week', notes: 'Long-acting, increases RBC'},
        {id: 'aas018', name: 'Boldenone Cypionate', category: 'aas', commonDosage: '300-600 mg/week', notes: 'Medium-acting boldenone'},
        {id: 'aas019', name: 'Drostanolone Propionate (Masteron)', category: 'aas', commonDosage: '300-600 mg/week', notes: 'DHT derivative, hardening'},
        {id: 'aas020', name: 'Drostanolone Enanthate', category: 'aas', commonDosage: '400-600 mg/week', notes: 'Long-acting masteron'},
        {id: 'aas021', name: 'Methenolone Enanthate (Primobolan)', category: 'aas', commonDosage: '400-800 mg/week', notes: 'Mild, low side effects'},
        {id: 'aas022', name: 'Methenolone Acetate', category: 'aas', commonDosage: '50-100 mg EOD', notes: 'Short-acting primobolan'},
        {id: 'aas023', name: 'Stanozolol (Winstrol Injectable)', category: 'aas', commonDosage: '50-100 mg/day or EOD', notes: 'DHT derivative, water-based'},
        {id: 'aas024', name: 'Mesterolone (Proviron Injectable)', category: 'aas', commonDosage: 'Rare - typically oral', notes: 'DHT derivative, SHBG binding'},
        {id: 'aas025', name: 'Testosterone/Trenbolone/Masteron Blend', category: 'aas', commonDosage: '1-2 ml/week', notes: 'Common cutting blend'},
        {id: 'aas026', name: 'Testosterone/Nandrolone/Boldenone Blend', category: 'aas', commonDosage: '1-2 ml/week', notes: 'Bulking blend'},
        {id: 'aas027', name: 'Test/Tren/EQ Blend', category: 'aas', commonDosage: '1-2 ml/week', notes: 'Recomp blend'},
        {id: 'aas028', name: 'Trenbolone Base (No Ester)', category: 'aas', commonDosage: '50-100 mg pre-workout', notes: 'Immediate acting trenbolone'},
        {id: 'aas029', name: 'Nandrolone Base (No Ester)', category: 'aas', commonDosage: '50-100 mg pre-workout', notes: 'Immediate acting nandrolone'},
        {id: 'aas030', name: 'Drostanolone Base (No Ester)', category: 'aas', commonDosage: '50-100 mg pre-workout', notes: 'Immediate acting masteron'},
        {id: 'aas031', name: 'DHB (Dihydroboldenone/1-Testosterone)', category: 'aas', commonDosage: '200-400 mg/week', notes: 'Boldenone derivative, no aromatization'},
        {id: 'aas032', name: 'MENT (Trestolone Acetate)', category: 'aas', commonDosage: '10-50 mg/day', notes: 'Highly potent 19-nor'},
        {id: 'aas033', name: 'Stenbolone Acetate', category: 'aas', commonDosage: '50-100 mg EOD', notes: 'DHT derivative'},
        {id: 'aas034', name: 'Methyl-1-Testosterone (Injectable)', category: 'aas', commonDosage: '10-20 mg/day', notes: 'Highly potent DHT derivative'},
        {id: 'aas035', name: 'Testosterone Acetate', category: 'aas', commonDosage: '50-100 mg EOD', notes: 'Very short-acting testosterone'},
        {id: 'aas036', name: 'Nandrolone Cypionate', category: 'aas', commonDosage: '200-400 mg/week', notes: 'Medium-acting nandrolone'},
        {id: 'aas037', name: 'Testosterone Blend (Custom)', category: 'aas', commonDosage: 'Variable', notes: 'Custom testosterone ester blends'},
        {id: 'aas038', name: 'Tri-Tren (Trenbolone Blend)', category: 'aas', commonDosage: '200-400 mg/week', notes: 'Three trenbolone esters'},
        {id: 'aas039', name: 'Tri-Test (Testosterone Blend)', category: 'aas', commonDosage: '300-600 mg/week', notes: 'Three testosterone esters'},
        {id: 'aas040', name: 'Super Test 450', category: 'aas', commonDosage: '450-900 mg/week', notes: 'High concentration test blend'}
    ]
};

// PPA Application - Main JavaScript
const PIN_CODE = '0119';
let currentFilter = 'all';
let currentTab = 'dashboard';
let substances = [];
let inventory = [];
let transactions = [];
let groupBuys = [];

// Initialize app
document.addEventListener('DOMContentLoaded', function() {
    loadData();
    setupPinScreen();
    setupEventListeners();
    setupAutoCalculations();
});

// PIN Screen
// PIN Screen
let currentPin = '';

function addDigit(digit) {
    if (currentPin.length < 4) {
        currentPin += digit;
        updatePinDisplay();
    }
}

function deleteDigit() {
    if (currentPin.length > 0) {
        currentPin = currentPin.slice(0, -1);
        updatePinDisplay();
    }
}

function clearPin() {
    currentPin = '';
    updatePinDisplay();
}

function updatePinDisplay() {
    const pinInput = document.getElementById('pinInput');
    const enterBtn = document.getElementById('enterBtn');
    
    // Display dots for each digit
    pinInput.value = 'â€¢'.repeat(currentPin.length);
    
    // Enable/disable enter button
    if (currentPin.length === 4) {
        enterBtn.disabled = false;
    } else {
        enterBtn.disabled = true;
    }
}

function setupPinScreen() {
    // Reset on load
    currentPin = '';
    updatePinDisplay();
}

function checkPin() {
    const pinInput = document.getElementById('pinInput');
    const pinError = document.getElementById('pinError');
    const enterBtn = document.getElementById('enterBtn');
    
    if (currentPin === PIN_CODE) {
        document.getElementById('pinScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        initializeApp();
        currentPin = '';
    } else {
        pinError.style.display = 'block';
        pinInput.style.borderColor = '#e74c3c';
        currentPin = '';
        updatePinDisplay();
        
        setTimeout(() => {
            pinError.style.display = 'none';
            pinInput.style.borderColor = '#ddd';
        }, 2000);
    }
}

// Make functions global
window.addDigit = addDigit;
window.deleteDigit = deleteDigit;
window.clearPin = clearPin;
window.checkPin = checkPin;

function lockApp() {
    document.getElementById('pinScreen').style.display = 'flex';
    document.getElementById('mainApp').style.display = 'none';
    document.getElementById('pinInput').value = '';
    document.getElementById('pinInput').focus();
}

function initializeApp() {
    renderDashboard();
    renderDatabase();
    renderInventory();
    renderTransactions();
    renderGroupBuys();
}

function switchTab(tabName) {
    currentTab = tabName;
    
    document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(tabName).classList.add('active');
    
    if (tabName === 'dashboard') renderDashboard();
    if (tabName === 'database') renderDatabase();
    if (tabName === 'inventory') renderInventory();
    if (tabName === 'transactions') renderTransactions();
    if (tabName === 'groupbuys') renderGroupBuys();
}

function renderDashboard() {
    document.getElementById('totalItems').textContent = substances.length;
    
    const totalValue = inventory.reduce((sum, item) => {
        const quantity = item.quantity || 0;
        const price = item.pricePaid || 0;
        return sum + (quantity > 0 ? price : 0);
    }, 0);
    document.getElementById('inventoryValue').textContent = '$' + totalValue.toFixed(2);
    
    const activeItems = inventory.filter(item => item.quantity > 0).length;
    document.getElementById('activeItems').textContent = activeItems;
    
    const now = new Date();
    const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
    const monthTransactions = transactions.filter(t => new Date(t.dateReceived) >= firstDayOfMonth);
    document.getElementById('totalTransactions').textContent = monthTransactions.length;
    
    const recentDiv = document.getElementById('recentActivity');
    if (transactions.length === 0) {
        recentDiv.innerHTML = '<div class="empty-state"><h3>No recent activity</h3><p>Add items to inventory to see activity here</p></div>';
    } else {
        const recent = [...transactions].sort((a, b) => new Date(b.dateReceived) - new Date(a.dateReceived)).slice(0, 5);
        recentDiv.innerHTML = `
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${recent.map(t => `
                        <tr>
                            <td>${formatDate(t.dateReceived)}</td>
                            <td>${getSubstanceName(t.substanceId)}</td>
                            <td>${t.quantity} vials (${t.totalMg}mg)</td>
                            <td>$${t.pricePaid.toFixed(2)}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }
}

function renderDatabase() {
    const grid = document.getElementById('substanceGrid');
    
    let filtered = substances;
    
    if (currentFilter !== 'all') {
        filtered = substances.filter(s => s.category === currentFilter);
    }
    
    const searchTerm = document.getElementById('searchBox').value.toLowerCase();
    if (searchTerm) {
        filtered = filtered.filter(s => 
            s.name.toLowerCase().includes(searchTerm) ||
            (s.notes && s.notes.toLowerCase().includes(searchTerm))
        );
    }
    
    if (filtered.length === 0) {
        grid.innerHTML = '<div class="empty-state"><h3>No substances found</h3><p>Try adjusting your search or filter</p></div>';
        return;
    }
    
    grid.innerHTML = filtered.map(substance => `
        <div class="substance-card" onclick="openAddInventoryModal('${substance.id}')">
            <span class="category">${formatCategory(substance.category)}</span>
            <h4>${substance.name}</h4>
            <div class="info">
                ${substance.commonDosage ? `<div><strong>Dosage:</strong> ${substance.commonDosage}</div>` : ''}
                ${substance.notes ? `<div style="margin-top: 5px; color: #999;">${substance.notes}</div>` : ''}
            </div>
        </div>
    `).join('');
}

function filterByCategory(category) {
    currentFilter = category;
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    renderDatabase();
}

function filterSubstances() {
    renderDatabase();
}

function renderInventory() {
    const content = document.getElementById('inventoryContent');
    
    if (inventory.length === 0) {
        content.innerHTML = '<div class="empty-state"><h3>No inventory yet</h3><p>Click on substances in the Database tab to add them to inventory</p></div>';
        return;
    }
    
    const grouped = {};
    inventory.forEach(item => {
        if (!grouped[item.substanceId]) {
            grouped[item.substanceId] = {
                substanceId: item.substanceId,
                totalVials: 0,
                totalMg: 0,
                totalValue: 0,
                entries: []
            };
        }
        grouped[item.substanceId].totalVials += item.quantity || 0;
        grouped[item.substanceId].totalMg += parseFloat(item.totalMg) || 0;
        grouped[item.substanceId].totalValue += item.pricePaid || 0;
        grouped[item.substanceId].entries.push(item);
    });
    
    content.innerHTML = `
        <table class="data-table">
            <thead>
                <tr>
                    <th>Substance</th>
                    <th>Total Vials</th>
                    <th>Total mg</th>
                    <th>Total Value</th>
                    <th>Avg Cost/mg</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                ${Object.values(grouped).map(item => {
                    const avgCost = item.totalMg > 0 ? (item.totalValue / item.totalMg) : 0;
                    return `
                        <tr>
                            <td onclick="showInventoryDetails('${item.substanceId}')" style="cursor: pointer;"><strong>${getSubstanceName(item.substanceId)}</strong></td>
                            <td>${item.totalVials}</td>
                            <td>${item.totalMg.toFixed(1)} mg</td>
                            <td>$${item.totalValue.toFixed(2)}</td>
                            <td>$${avgCost.toFixed(3)}/mg</td>
                            <td><button class="btn btn-primary btn-small" onclick="openUseSellModal('${item.substanceId}')">Use/Sell</button></td>
                        </tr>
                    `;
                }).join('')}
            </tbody>
        </table>
    `;
}

function showInventoryDetails(substanceId) {
    const items = inventory.filter(i => i.substanceId === substanceId);
    const substance = getSubstanceName(substanceId);
    
    alert(`Inventory Details for ${substance}\n\n` + 
          items.map((item, idx) => 
              `Entry ${idx + 1}:\n` +
              `  Date: ${formatDate(item.dateReceived)}\n` +
              `  Quantity: ${item.quantity} vials (${item.vialSize}mg each)\n` +
              `  Vendor: ${item.vendor}\n` +
              `  Price: $${item.pricePaid.toFixed(2)}\n` +
              `  ${item.lotNumber ? 'Lot: ' + item.lotNumber : ''}`
          ).join('\n\n'));
}

function renderTransactions() {
    const content = document.getElementById('transactionsContent');
    
    if (transactions.length === 0) {
        content.innerHTML = '<div class="empty-state"><h3>No transactions yet</h3><p>Transactions will appear here when you add items to inventory</p></div>';
        return;
    }
    
    const sorted = [...transactions].sort((a, b) => new Date(b.dateReceived) - new Date(a.dateReceived));
    
    content.innerHTML = `
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Substance</th>
                    <th>Quantity</th>
                    <th>Vendor</th>
                    <th>Price</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                ${sorted.map(t => `
                    <tr>
                        <td>${formatDate(t.dateReceived)}</td>
                        <td><span style="padding: 4px 8px; background: ${getTypeColor(t.transactionType)}; color: white; border-radius: 4px; font-size: 12px;">${formatType(t.transactionType)}</span></td>
                        <td>${getSubstanceName(t.substanceId)}</td>
                        <td>${t.quantity} Ã— ${t.vialSize}mg</td>
                        <td>${t.vendor}</td>
                        <td>$${t.pricePaid.toFixed(2)}</td>
                        <td>${t.notes || (t.lotNumber ? 'Lot: ' + t.lotNumber : '-')}</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function renderGroupBuys() {
    const content = document.getElementById('groupbuysContent');
    
    if (groupBuys.length === 0) {
        content.innerHTML = '<div class="empty-state"><h3>No group buys yet</h3><p>Click "New Group Buy" to track group purchases</p></div>';
        return;
    }
    
    const sorted = [...groupBuys].sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
    
    content.innerHTML = `
        <table class="data-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Organizer</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Method</th>
                    <th>Status</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                ${sorted.map(gb => `
                    <tr>
                        <td><strong>${gb.name}</strong></td>
                        <td>${gb.organizer}</td>
                        <td>$${gb.amount.toFixed(2)}</td>
                        <td>${gb.date ? formatDate(gb.date) : '-'}</td>
                        <td>${gb.paymentMethod || '-'}</td>
                        <td><span style="padding: 4px 8px; background: ${getStatusColor(gb.status)}; color: white; border-radius: 4px; font-size: 12px;">${formatStatus(gb.status)}</span></td>
                        <td>${gb.notes || '-'}</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function openAddSubstanceModal() {
    document.getElementById('addSubstanceModal').style.display = 'block';
    document.getElementById('substanceName').focus();
}

function openAddInventoryModal(substanceId) {
    const substance = substances.find(s => s.id === substanceId);
    if (!substance) return;
    
    document.getElementById('addInventoryModal').style.display = 'block';
    document.getElementById('invSubstanceId').value = substanceId;
    document.getElementById('selectedSubstanceName').textContent = substance.name;
    document.getElementById('dateReceived').valueAsDate = new Date();
}

function openAddGroupBuyModal() {
    document.getElementById('addGroupBuyModal').style.display = 'block';
    document.getElementById('gbName').focus();
}

function openUseSellModal(substanceId) {
    const substance = substances.find(s => s.id === substanceId);
    if (!substance) return;
    
    document.getElementById('useSellModal').style.display = 'block';
    document.getElementById('useSellSubstanceId').value = substanceId;
    document.getElementById('useSellSubstanceName').textContent = substance.name;
    document.getElementById('useSellDate').valueAsDate = new Date();
    
    // Show/hide price field based on type
    document.getElementById('useSellType').addEventListener('change', function() {
        const priceGroup = document.getElementById('sellPriceGroup');
        priceGroup.style.display = this.value === 'sell' ? 'block' : 'none';
    });
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
    
    if (modalId === 'addSubstanceModal') {
        document.getElementById('addSubstanceForm').reset();
    } else if (modalId === 'addInventoryModal') {
        document.getElementById('addInventoryForm').reset();
    } else if (modalId === 'addGroupBuyModal') {
        document.getElementById('addGroupBuyForm').reset();
    } else if (modalId === 'useSellModal') {
        document.getElementById('useSellForm').reset();
    }
}

function toggleGroupBuyFields() {
    const type = document.getElementById('transactionType').value;
    const fields = document.getElementById('groupBuyFields');
    fields.style.display = type === 'groupbuy' ? 'block' : 'none';
}

function setupEventListeners() {
    document.getElementById('addSubstanceForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const newSubstance = {
            id: 'custom_' + Date.now(),
            name: document.getElementById('substanceName').value,
            category: document.getElementById('substanceCategory').value,
            commonDosage: document.getElementById('substanceDosage').value,
            notes: document.getElementById('substanceNotes').value
        };
        
        substances.push(newSubstance);
        saveData();
        closeModal('addSubstanceModal');
        renderDatabase();
        
        alert('Substance added successfully!');
    });
    
    document.getElementById('addInventoryForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const newTransaction = {
            id: 'trans_' + Date.now(),
            substanceId: document.getElementById('invSubstanceId').value,
            transactionType: document.getElementById('transactionType').value,
            dateReceived: document.getElementById('dateReceived').value,
            quantity: parseInt(document.getElementById('quantity').value),
            vialSize: parseFloat(document.getElementById('vialSize').value),
            totalMg: parseFloat(document.getElementById('totalMg').value),
            pricePaid: parseFloat(document.getElementById('pricePaid').value),
            vendor: document.getElementById('vendor').value,
            lotNumber: document.getElementById('lotNumber').value,
            notes: document.getElementById('invNotes').value
        };
        
        if (newTransaction.transactionType === 'groupbuy') {
            newTransaction.groupBuy = {
                organizer: document.getElementById('gbOrganizer').value,
                amount: parseFloat(document.getElementById('gbAmount').value) || 0,
                paymentDate: document.getElementById('gbPaymentDate').value,
                paymentMethod: document.getElementById('gbPaymentMethod').value
            };
        }
        
        const invItem = {
            id: newTransaction.id,
            substanceId: newTransaction.substanceId,
            quantity: newTransaction.quantity,
            vialSize: newTransaction.vialSize,
            totalMg: newTransaction.totalMg,
            pricePaid: newTransaction.pricePaid,
            vendor: newTransaction.vendor,
            dateReceived: newTransaction.dateReceived,
            lotNumber: newTransaction.lotNumber
        };
        
        inventory.push(invItem);
        transactions.push(newTransaction);
        
        saveData();
        closeModal('addInventoryModal');
        renderDashboard();
        renderInventory();
        renderTransactions();
        
        alert('Added to inventory successfully!');
    });
    
    document.getElementById('addGroupBuyForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const newGroupBuy = {
            id: 'gb_' + Date.now(),
            name: document.getElementById('gbName').value,
            organizer: document.getElementById('gbOrganizerStandalone').value,
            amount: parseFloat(document.getElementById('gbTotalAmount').value),
            date: document.getElementById('gbDate').value,
            paymentMethod: document.getElementById('gbMethod').value,
            status: document.getElementById('gbStatus').value,
            notes: document.getElementById('gbNotes').value
        };
        
        groupBuys.push(newGroupBuy);
        saveData();
        closeModal('addGroupBuyModal');
        renderGroupBuys();
        
        alert('Group buy created successfully!');
    });
    
    // Use/Sell form submission
    document.getElementById('useSellForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const substanceId = document.getElementById('useSellSubstanceId').value;
        const type = document.getElementById('useSellType').value;
        const date = document.getElementById('useSellDate').value;
        const quantity = parseFloat(document.getElementById('useSellQuantity').value);
        const price = type === 'sell' ? parseFloat(document.getElementById('sellPrice').value) || 0 : 0;
        const notes = document.getElementById('useSellNotes').value;
        
        // Find matching inventory items
        const matchingItems = inventory.filter(item => item.substanceId === substanceId && item.quantity > 0);
        
        if (matchingItems.length === 0) {
            alert('No inventory available for this substance!');
            return;
        }
        
        let remainingToRemove = quantity;
        
        // Remove from inventory (FIFO - first in, first out)
        matchingItems.forEach(item => {
            if (remainingToRemove <= 0) return;
            
            if (item.quantity >= remainingToRemove) {
                item.quantity -= remainingToRemove;
                remainingToRemove = 0;
            } else {
                remainingToRemove -= item.quantity;
                item.quantity = 0;
            }
        });
        
        if (remainingToRemove > 0) {
            alert(`Warning: Only ${quantity - remainingToRemove} vials were available. Removed all available stock.`);
        }
        
        // Record outgoing transaction
        const outgoingTransaction = {
            id: 'out_' + Date.now(),
            substanceId: substanceId,
            transactionType: type,
            date: date,
            quantity: quantity - remainingToRemove,
            price: price,
            notes: notes
        };
        
        transactions.push(outgoingTransaction);
        
        saveData();
        closeModal('useSellModal');
        renderDashboard();
        renderInventory();
        renderTransactions();
        
        alert(`Successfully recorded: ${quantity - remainingToRemove} vial(s) ${type === 'sell' ? 'sold' : type === 'use' ? 'used' : type === 'dispose' ? 'disposed' : 'gifted'}!`);
    });
    
    window.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
            e.target.style.display = 'none';
        }
    });
}

function setupAutoCalculations() {
    const quantityInput = document.getElementById('quantity');
    const vialSizeInput = document.getElementById('vialSize');
    const totalMgInput = document.getElementById('totalMg');
    
    function calculateTotal() {
        const quantity = parseFloat(quantityInput.value) || 0;
        const vialSize = parseFloat(vialSizeInput.value) || 0;
        totalMgInput.value = (quantity * vialSize).toFixed(1) + ' mg';
    }
    
    quantityInput.addEventListener('input', calculateTotal);
    vialSizeInput.addEventListener('input', calculateTotal);
}

function exportToCSV() {
    let csv = 'PPA Export - ' + new Date().toLocaleDateString() + '\n\n';
    
    csv += 'INVENTORY\n';
    csv += 'Substance,Total Vials,Total mg,Total Value\n';
    const grouped = {};
    inventory.forEach(item => {
        if (!grouped[item.substanceId]) {
            grouped[item.substanceId] = { vials: 0, mg: 0, value: 0 };
        }
        grouped[item.substanceId].vials += item.quantity || 0;
        grouped[item.substanceId].mg += parseFloat(item.totalMg) || 0;
        grouped[item.substanceId].value += item.pricePaid || 0;
    });
    
    Object.keys(grouped).forEach(substanceId => {
        const item = grouped[substanceId];
        csv += `"${getSubstanceName(substanceId)}",${item.vials},${item.mg.toFixed(1)},${item.value.toFixed(2)}\n`;
    });
    
    csv += '\nTRANSACTIONS\n';
    csv += 'Date,Type,Substance,Quantity,Vial Size,Vendor,Price,Lot Number,Notes\n';
    transactions.forEach(t => {
        csv += `${t.dateReceived},"${formatType(t.transactionType)}","${getSubstanceName(t.substanceId)}",${t.quantity},${t.vialSize},"${t.vendor}",${t.pricePaid},"${t.lotNumber || ''}","${t.notes || ''}"\n`;
    });
    
    csv += '\nGROUP BUYS\n';
    csv += 'Name,Organizer,Amount,Date,Method,Status,Notes\n';
    groupBuys.forEach(gb => {
        csv += `"${gb.name}","${gb.organizer}",${gb.amount},"${gb.date || ''}","${gb.paymentMethod || ''}","${formatStatus(gb.status)}","${gb.notes || ''}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'PPA_Export_' + Date.now() + '.csv';
    a.click();
    window.URL.revokeObjectURL(url);
}

function exportToGoogleSheets() {
    alert('Google Sheets Export\n\n' +
          'To export to Google Sheets:\n' +
          '1. Export to CSV first\n' +
          '2. Open Google Sheets\n' +
          '3. File > Import > Upload\n' +
          '4. Select your CSV file\n\n' +
          'Direct API integration coming in future update!');
}

function importFromGoogleSheets() {
    alert('Google Sheets Import\n\n' +
          'To import from Google Sheets:\n' +
          '1. Download your sheet as CSV\n' +
          '2. Format columns to match PPA format\n' +
          '3. Use browser file import (coming soon)\n\n' +
          'Direct API integration coming in future update!');
}

function formatCategory(category) {
    const map = {
        'peptide': 'Peptide',
        'bioregulator': 'Bioregulator',
        'aas': 'AAS',
        'custom': 'Custom'
    };
    return map[category] || category;
}

function formatType(type) {
    const map = {
        'purchase': 'Purchase',
        'groupbuy': 'Group Buy',
        'gift': 'Gift/Sample'
    };
    return map[type] || type;
}

function formatStatus(status) {
    const map = {
        'pending': 'Pending',
        'paid': 'Paid',
        'received': 'Received',
        'cancelled': 'Cancelled'
    };
    return map[status] || status;
}

function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

function getSubstanceName(substanceId) {
    const substance = substances.find(s => s.id === substanceId);
    return substance ? substance.name : 'Unknown';
}

function getTypeColor(type) {
    const colors = {
        'purchase': '#06b6d4',
        'groupbuy': '#0891b2',
        'gift': '#48bb78'
    };
    return colors[type] || '#999';
}

function getStatusColor(status) {
    const colors = {
        'pending': '#f39c12',
        'paid': '#3498db',
        'received': '#27ae60',
        'cancelled': '#e74c3c'
    };
    return colors[status] || '#999';
}

function loadData() {
    const savedSubstances = localStorage.getItem('ppa_substances');
    const savedInventory = localStorage.getItem('ppa_inventory');
    const savedTransactions = localStorage.getItem('ppa_transactions');
    const savedGroupBuys = localStorage.getItem('ppa_groupbuys');
    
    if (savedSubstances) {
        substances = JSON.parse(savedSubstances);
    } else {
        substances = [...DATABASE.peptides, ...DATABASE.steroids];
        saveData();
    }
    
    if (savedInventory) inventory = JSON.parse(savedInventory);
    if (savedTransactions) transactions = JSON.parse(savedTransactions);
    if (savedGroupBuys) groupBuys = JSON.parse(savedGroupBuys);
}

function saveData() {
    localStorage.setItem('ppa_substances', JSON.stringify(substances));
    localStorage.setItem('ppa_inventory', JSON.stringify(inventory));
    localStorage.setItem('ppa_transactions', JSON.stringify(transactions));
    localStorage.setItem('ppa_groupbuys', JSON.stringify(groupBuys));
}

function getStatusBadgeType(status) {
    return { 'pending': 'warning', 'paid': 'primary', 'received': 'success', 'cancelled': 'danger' }[status] || 'primary';
}

function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

function getSubstanceName(substanceId) {
    const substance = substances.find(s => s.id === substanceId);
    return substance ? substance.name : 'Unknown';
}

function loadData() {
    const savedSubstances = localStorage.getItem('ppa_substances');
    const savedInventory = localStorage.getItem('ppa_inventory');
    const savedTransactions = localStorage.getItem('ppa_transactions');
    const savedGroupBuys = localStorage.getItem('ppa_groupbuys');
    
    if (savedSubstances) {
        substances = JSON.parse(savedSubstances);
    } else {
        substances = [...DATABASE.peptides, ...DATABASE.steroids];
        saveData();
    }
    
    if (savedInventory) inventory = JSON.parse(savedInventory);
    if (savedTransactions) transactions = JSON.parse(savedTransactions);
    if (savedGroupBuys) groupBuys = JSON.parse(savedGroupBuys);
}

function saveData() {
    localStorage.setItem('ppa_substances', JSON.stringify(substances));
    localStorage.setItem('ppa_inventory', JSON.stringify(inventory));
    localStorage.setItem('ppa_transactions', JSON.stringify(transactions));
    localStorage.setItem('ppa_groupbuys', JSON.stringify(groupBuys));
}

window.switchTab = switchTab;
window.lockApp = lockApp;
window.filterByCategory = filterByCategory;
window.filterSubstances = filterSubstances;
window.openAddSubstanceModal = openAddSubstanceModal;
window.openAddInventoryModal = openAddInventoryModal;
window.openAddGroupBuyModal = openAddGroupBuyModal;
window.openUseSellModal = openUseSellModal;
window.closeModal = closeModal;
window.toggleGroupBuyFields = toggleGroupBuyFields;
window.showInventoryDetails = showInventoryDetails;
window.exportToCSV = exportToCSV;
window.exportToGoogleSheets = exportToGoogleSheets;
window.importFromGoogleSheets = importFromGoogleSheets;
    </script>
</body>
</html>
